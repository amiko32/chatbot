<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–†–∞–º–∏–ª–µüíó</title>
  <meta name="theme-color" content="#ffb6d9" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --pink-1:#fff0f6;/* very light */
      --pink-2:#ffd6e7;/* light */
      --pink-3:#ffb6d9;/* primary */
      --pink-4:#ff87c5;/* accent */
      --rose-1:#ffeff5;
      --text:#3a2a35;
      --muted:#886878;
      --card:#ffffffcc; /* glass */
      --shadow:0 10px 30px rgba(255, 134, 197, .25);
      --radius:22px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:"Poppins",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 10% -10%, #ffe3f2 0%, transparent 60%),
        radial-gradient(1200px 700px at 110% 10%, #ffeaf6 0%, transparent 60%),
        linear-gradient(180deg, var(--pink-1), #ffffff);
      position:relative;
      overflow:hidden;
    }
    /* floating hearts */
    .heart{position:absolute;opacity:.25;animation:float 18s linear infinite}
    .heart:nth-child(1){left:6%;top:75%;font-size:48px;animation-duration:22s}
    .heart:nth-child(2){left:85%;top:70%;font-size:38px;animation-duration:26s}
    .heart:nth-child(3){left:12%;top:25%;font-size:32px}
    .heart:nth-child(4){left:75%;top:20%;font-size:52px;animation-duration:28s}
    @keyframes float{0%{transform:translateY(0) rotate(0)}100%{transform:translateY(-120vh) rotate(360deg)}}

    header{
      position:sticky;top:0;z-index:50;
      backdrop-filter:saturate(1.4) blur(8px);
      background:linear-gradient(90deg, #ffffffaa, #ffe9f6aa);
      box-shadow:0 2px 12px rgba(255,183,219,.25);
    }
    .container{max-width:980px;margin:0 auto;padding:16px}
    .topbar{display:flex;align-items:center;gap:12px;justify-content:space-between}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{
      width:42px;height:42px;border-radius:50%;
      background:radial-gradient(circle at 30% 30%, #fff, #ffc2dd 60%, #ff9fcd 100%);
      box-shadow:0 8px 18px rgba(255, 143, 197, .4);
      position:relative
    }
    .logo:after{content:"";position:absolute;inset:-2px;border-radius:50%;border:2px solid #fff6;filter:blur(.5px)}
    .title{font-weight:700;letter-spacing:.3px}
    .subtitle{font-size:12px;color:var(--muted);margin-top:-6px}

    .settings-btn{
      border:none;background:linear-gradient(180deg,#fff,#ffecf6);
      border-radius:999px;padding:10px 14px;font-weight:600;color:var(--text);
      box-shadow:0 6px 16px rgba(255, 146, 198,.24);
      display:inline-flex;align-items:center;gap:8px;cursor:pointer
    }
    .settings-btn:hover{transform:translateY(-1px)}

    main{padding:18px}
    .card{
      background:var(--card);border:1px solid #ffe1ef;box-shadow:var(--shadow);
      border-radius:var(--radius);overflow:hidden
    }

    .chat{
      display:grid;grid-template-rows:auto 1fr auto;min-height:68vh
    }
    .chat-header{
      padding:18px 18px 0
    }
    .chat-header h2{margin:0;font-size:20px}
    .chat-header p{margin:6px 0 0;color:var(--muted);font-size:13px}

    .messages{padding:16px;display:flex;flex-direction:column;gap:14px;overflow:auto}
    .bubble{
      max-width:min(78ch, 90%);
      padding:12px 14px;border-radius:18px;line-height:1.45
    }
    .ai{align-self:flex-start;background:linear-gradient(180deg,#fff8fd,#ffe5f2);border:1px solid #ffd1e6}
    .me{align-self:flex-end;background:#fff;border:1px solid #ffe1ef}
    .meta{display:flex;align-items:center;gap:8px;font-size:12px;color:var(--muted)}

    .composer{display:flex;gap:10px;padding:14px;border-top:1px solid #ffe1ef;background:linear-gradient(180deg,#fff,#fff8fd)}
    .composer textarea{flex:1;resize:none;min-height:46px;max-height:140px;padding:12px 14px;border-radius:14px;border:1px solid #ffd6e7;outline:none;font-family:inherit}
    .composer textarea:focus{box-shadow:0 0 0 4px #ffebf5}
    .composer button{
      min-width:84px;border:none;border-radius:14px;padding:12px 16px;font-weight:700;cursor:pointer;color:#fff;
      background:linear-gradient(180deg,var(--pink-4),#ff69b1);
      box-shadow:0 8px 18px rgba(255, 105, 177,.35)
    }
    .toolbar{display:flex;gap:10px;flex-wrap:wrap}
    .toolbar button.secondary{background:linear-gradient(180deg,#fff,#ffeef6);color:var(--text);border:1px solid #ffd6e7;box-shadow:none}

    .hint{font-size:12px;color:var(--muted);padding:0 16px 14px}

    dialog.settings{border:none;border-radius:18px;max-width:640px;width:92%;padding:0;box-shadow:0 24px 64px rgba(0,0,0,.18)}
    .settings .titlebar{display:flex;justify-content:space-between;align-items:center;padding:18px;border-bottom:1px solid #ffe1ef;background:linear-gradient(180deg,#fff,#fff8fd)}
    .settings .content{padding:18px;display:grid;gap:14px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .field{display:grid;gap:6px}
    .field label{font-size:13px;color:var(--muted)}
    .field input,.field select,.field textarea{width:100%;padding:10px 12px;border-radius:12px;border:1px solid #ffd6e7;outline:none}
    .settings .actions{display:flex;justify-content:flex-end;gap:10px;padding:14px;border-top:1px solid #ffe1ef;background:#fff}

    .typing{display:flex;gap:6px;align-items:center}
    .dot{width:6px;height:6px;border-radius:50%;background:#ff9fcd;opacity:.6;animation:blink 1.2s infinite ease-in-out}
    .dot:nth-child(2){animation-delay:.2s}.dot:nth-child(3){animation-delay:.4s}
    @keyframes blink{0%,80%,100%{opacity:.2}40%{opacity:1}}

    footer{padding:22px;text-align:center;color:var(--muted);font-size:12px}
    a{color:#d84e93}
    @media (max-width:720px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <!-- floating hearts -->
  <div class="heart">üíó</div>
  <div class="heart">üíï</div>
  <div class="heart">üíñ</div>
  <div class="heart">üíû</div>

  <header>
    <div class="container topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <div class="title">–†–∞–º–∏–ª—èGPT</div>
          <div class="subtitle">–Ω–µ–∂–Ω—ã–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫</div>
        </div>
      </div>
      <button class="settings-btn" id="openSettings">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
    </div>
  </header>

  <main class="container">
    <section class="card chat" aria-live="polite">
      <div class="chat-header">
        <h2>–ü—Ä–∏–≤–µ—Ç, —è —Ä—è–¥–æ–º üíï</h2>
        <p>–ù–∞–ø–∏—à–∏ —á—Ç–æ —É–≥–æ–¥–Ω–æ: —Å–æ–≤–µ—Ç –ø–æ —É—á—ë–±–µ, –∏–¥–µ—é –¥–ª—è —Å–≤–∏–¥–∞–Ω–∏—è, —Ä–µ—Ü–µ–ø—Ç, –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç ‚Äî —è –ø–æ–º–æ–≥—É.</p>
      </div>

      <div id="messages" class="messages"></div>

      <div class="composer">
        <textarea id="input" placeholder="–ù–∞–ø–∏—à–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ‚Ä¶ (Shift+Enter ‚Äî –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏)"></textarea>
        <div class="toolbar">
          <button id="send">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
          <button class="secondary" id="clearChat" title="–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é">–û—á–∏—Å—Ç–∏—Ç—å</button>
          <button class="secondary" id="exportChat" title="–°–∫–∞—á–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞ .txt">–°–∫–∞—á–∞—Ç—å</button>
        </div>
      </div>
      <div class="hint">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ä–∞–±–æ—Ç–∞–µ—Ç –º–∏–ª—ã–π –æ—Ñ–ª–∞–π–Ω‚Äë—Ä–µ–∂–∏–º (–±–µ–∑ –∫–ª—é—á–∞). –ú–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –ª—é–±–æ–π OpenAI‚Äë—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π API –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.</div>
    </section>
  </main>

  <footer>
    –°–¥–µ–ª–∞–Ω–æ —Å –ª—é–±–æ–≤—å—é –¥–ª—è –†–∞–º–∏–ª–∏ üíó | <span id="modeLabel">–†–µ–∂–∏–º: –æ—Ñ–ª–∞–π–Ω</span>
  </footer>

  <!-- Settings modal -->
  <dialog class="settings" id="settings">
    <div class="titlebar">
      <strong>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</strong>
      <button id="closeSettings" class="settings-btn">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
    <div class="content">
      <div class="grid">
        <div class="field">
          <label for="mode">–†–µ–∂–∏–º</label>
          <select id="mode">
            <option value="demo">–û—Ñ–ª–∞–π–Ω (–º–∏–ª—ã–µ –æ—Ç–≤–µ—Ç—ã)</option>
            <option value="openai">OpenAI‚Äë—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π API</option>
          </select>
        </div>
        <div class="field">
          <label for="model">–ú–æ–¥–µ–ª—å (–¥–ª—è API)</label>
          <input id="model" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, gpt-4o-mini" />
        </div>
        <div class="field">
          <label for="apiBase">API Base</label>
          <input id="apiBase" placeholder="https://api.openai.com/v1" />
        </div>
        <div class="field">
          <label for="apiKey">API Key</label>
          <input id="apiKey" type="password" placeholder="sk-..." />
        </div>
      </div>
      <div class="field">
        <label for="systemPrompt">–°–∏—Å—Ç–µ–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (—Ö–∞—Ä–∞–∫—Ç–µ—Ä –±–æ—Ç–∞)</label>
        <textarea id="systemPrompt" rows="3">–¢—ã ‚Äî –Ω–µ–∂–Ω—ã–π, –¥–æ–±—Ä—ã–π, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ –∏–º–µ–Ω–∏ –†–∞–º–∏–ª—èGPT. –û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ, —è—Å–Ω–æ –∏ –∑–∞–±–æ—Ç–ª–∏–≤–æ, —Å –ø–æ–∑–∏—Ç–∏–≤–æ–º –∏ —ç–º–æ–¥–∑–∏ –ø–æ –¥–µ–ª—É.</textarea>
      </div>
    </div>
    <div class="actions">
      <button class="settings-btn" id="saveSettings">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
  </dialog>

  <script>
    // --- utilities ---
    const $ = sel => document.querySelector(sel);
    const messagesEl = $('#messages');
    const inputEl = $('#input');
    const sendBtn = $('#send');
    const clearBtn = $('#clearChat');
    const exportBtn = $('#exportChat');

    const settingsDlg = $('#settings');
    const openSettingsBtn = $('#openSettings');
    const closeSettingsBtn = $('#closeSettings');
    const saveSettingsBtn = $('#saveSettings');

    const modeSel = $('#mode');
    const apiBaseInp = $('#apiBase');
    const apiKeyInp = $('#apiKey');
    const modelInp = $('#model');
    const systemPromptInp = $('#systemPrompt');
    const modeLabel = $('#modeLabel');

    const LS_KEY = 'ramila_gpt_v1';

    const state = {
      cfg: {
        mode: 'demo',
        apiBase: 'https://api.openai.com/v1',
        apiKey: '',
        model: 'gpt-4o-mini',
        systemPrompt: systemPromptInp.value
      },
      history: [] // {role:'user'|'assistant'|'system', content:string}
    };

    // Load from LocalStorage
    const saved = localStorage.getItem(LS_KEY);
    if (saved){
      try{
        const parsed = JSON.parse(saved);
        Object.assign(state.cfg, parsed.cfg||{});
        state.history = parsed.history || [];
      }catch(e){console.warn('Failed to parse saved state', e)}
    }

    // init UI from cfg
    function syncUI(){
      modeSel.value = state.cfg.mode;
      apiBaseInp.value = state.cfg.apiBase;
      apiKeyInp.value = state.cfg.apiKey;
      modelInp.value = state.cfg.model;
      systemPromptInp.value = state.cfg.systemPrompt;
      modeLabel.textContent = '–†–µ–∂–∏–º: ' + (state.cfg.mode==='demo' ? '–æ—Ñ–ª–∞–π–Ω' : 'API');
    }
    syncUI();

    function save(){
      localStorage.setItem(LS_KEY, JSON.stringify({cfg:state.cfg, history:state.history}));
    }

    // render chat
    function render(){
      messagesEl.innerHTML = '';
      if (state.history.length===0){
        addBubble('assistant', '–ü—Ä–∏–≤–µ—Ç, —Å–æ–ª–Ω—ã—à–∫–æ! –Ø –∑–¥–µ—Å—å –¥–ª—è —Ç–µ–±—è. –ö–∞–∫ —Ç–≤–æ—ë –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–µ–≥–æ–¥–Ω—è? üå∏');
        return;
      }
      for (const m of state.history){
        addBubble(m.role, m.content);
      }
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    function addBubble(role, text){
      const wrap = document.createElement('div');
      wrap.className = 'row';
      const bubble = document.createElement('div');
      bubble.className = 'bubble ' + (role==='assistant' ? 'ai' : 'me');
      bubble.textContent = text;
      wrap.appendChild(bubble);
      messagesEl.appendChild(wrap);
    }

    function addTyping(){
      const div = document.createElement('div');
      div.className = 'bubble ai';
      div.innerHTML = '<span class="typing"><span class="dot"></span><span class="dot"></span><span class="dot"></span></span>';
      messagesEl.appendChild(div);
      messagesEl.scrollTop = messagesEl.scrollHeight;
      return div;
    }

    // --- demo (offline) responder ---
    function demoReply(user){
      const compliments = [
        '–¢—ã –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–æ —Ç–∞–ª–∞–Ω—Ç–ª–∏–≤–∞—è ‚Äî —è –≤ —Ç–µ–±—è –≤–µ—Ä—é! ‚ú®',
        '–¢—ã –¥–µ–ª–∞–µ—à—å –º–∏—Ä –≤–æ–∫—Ä—É–≥ –Ω–µ–∂–Ω–µ–µ üíû',
        '–ü–æ–º–Ω—é: –æ—Ç–¥—ã—Ö ‚Äî —ç—Ç–æ —Ç–æ–∂–µ –¥–µ–ª–æ. –ì–æ—Ä–¥—é—Å—å —Ç–æ–±–æ–π! üå∑',
        '–° —Ç–æ–±–æ–π –≤—Å—ë –ø–æ–ª—É—á–∏—Ç—Å—è, –æ–±–µ—â–∞—é üíó',
      ];
      const lower = user.toLowerCase();
      if (/(–ø—Ä–∏–≤|—Å–∞–ª—é—Ç|—Ö–∞–π|hi|hello)/.test(lower)){
        return '–ü—Ä–∏–≤–µ—Ç–∏–∫! –û–±–Ω–∏–º–∞—é —Ç–µ–±—è –º—ã—Å–ª–µ–Ω–Ω–æ ü§ó –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?';
      }
      if (/—Ä–µ—Ü–µ–ø—Ç|–∫—É–ª–∏–Ω|–≥–æ—Ç–æ–≤/i.test(lower)){
        return '–ë—ã—Å—Ç—Ä—ã–π —Ä–µ—Ü–µ–ø—Ç –∫–ª—É–±–Ω–∏—á–Ω–æ–≥–æ —Å–º—É–∑–∏: –π–æ–≥—É—Ä—Ç 200 –º–ª + –∫–ª—É–±–Ω–∏–∫–∞ 150 –≥ + –±–∞–Ω–∞–Ω 1/2 + –º—ë–¥ 1 —á.–ª. ‚Äî –≤–∑–±–∏—Ç—å, —É–∫—Ä–∞—Å–∏—Ç—å –º—è—Ç–æ–π üçì';
      }
      if (/—É—á–µ–±|—ç–∫–∑–∞–º|–¥–∑|–¥–æ–º–∞—à–Ω/i.test(lower)){
        return '–°–¥–µ–ª–∞–π —Ç–∞–π–º–µ—Ä: 25 –º–∏–Ω—É—Ç —Ñ–æ–∫—É—Å + 5 –ø–µ—Ä–µ—Ä—ã–≤. –ù–∞—á–Ω–∏ —Å —Å–∞–º–æ–≥–æ –º–∞–ª–µ–Ω—å–∫–æ–≥–æ —à–∞–≥–∞, –æ—Å—Ç–∞–ª—å–Ω–æ–µ –ø–æ–π–¥—ë—Ç ‚úçÔ∏è';
      }
      if (/–≥—Ä—É—Å—Ç|–ø–ª–æ—Ö|—É—Å—Ç–∞–ª|—Å—Ç—Ä–µ—Å—Å/i.test(lower)){
        return '–¢—ã –Ω–µ –æ–±—è–∑–∞–Ω–∞ –±—ã—Ç—å –∏–¥–µ–∞–ª—å–Ω–æ–π. –ü–æ–¥—ã—à–∏–º 4-7-8: –≤–¥–æ—Ö 4, –∑–∞–¥–µ—Ä–∂–∫–∞ 7, –≤—ã–¥–æ—Ö 8. –Ø —Ä—è–¥–æ–º üíï';
      }
      if (/—Å–≤–∏–¥–∞–Ω|–∏–¥–µ—è|—Ä–æ–º–∞–Ω/i.test(lower)){
        return '–ò–¥–µ—è —Å–≤–∏–¥–∞–Ω–∏—è: –ø–ª–µ–π–ª–∏—Å—Ç –∏–∑ 10 –Ω–∞—à–∏—Ö –ø–µ—Å–µ–Ω + –ø–∏–∫–Ω–∏–∫ –¥–æ–º–∞ –Ω–∞ –ø–æ–ª—É —Å –ø–ª–µ–¥–æ–º –∏ —Å–≤–µ—á–∞–º–∏. –ë—é–¥–∂–µ—Ç–Ω–æ –∏ –æ—á–µ–Ω—å –º–∏–ª–æ ‚ú®';
      }
      // default
      return compliments[Math.floor(Math.random()*compliments.length)];
    }

    async function callOpenAI(history){
      const {apiBase, apiKey, model, systemPrompt} = state.cfg;
      const url = apiBase.replace(/\/$/, '') + '/chat/completions';
      const body = {
        model,
        messages: [
          {role:'system', content: systemPrompt},
          ...history
        ],
        temperature: 0.8
      };
      const res = await fetch(url, {
        method:'POST',
        headers:{'Content-Type':'application/json','Authorization':'Bearer ' + apiKey},
        body: JSON.stringify(body)
      });
      if (!res.ok){
        const t = await res.text();
        throw new Error('API error: '+res.status+' '+t);
      }
      const json = await res.json();
      return json.choices?.[0]?.message?.content?.trim() || '‚Ä¶';
    }

    async function handleSend(){
      const text = (inputEl.value||'').trim();
      if (!text) return;
      state.history.push({role:'user', content:text});
      save();
      render();
      inputEl.value = '';

      const typing = addTyping();

      try{
        let answer;
        if (state.cfg.mode === 'openai'){
          if (!state.cfg.apiKey){
            answer = '–î–ª—è —Ä–µ–∂–∏–º–∞ API –¥–æ–±–∞–≤—å –∫–ª—é—á –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö üíå';
          } else {
            answer = await callOpenAI(state.history);
          }
        } else {
          // demo mode
          await new Promise(r=>setTimeout(r, 500 + Math.random()*600));
          answer = demoReply(text);
        }
        typing.remove();
        state.history.push({role:'assistant', content:answer});
        save();
        render();
      }catch(err){
        typing.remove();
        const msg = '–û–π! ' + (err?.message || err) + '\n–ü—Ä–æ–≤–µ—Ä—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ API –∏–ª–∏ –≤—ã–±–µ—Ä–∏ —Ä–µ–∂–∏–º "–û—Ñ–ª–∞–π–Ω".';
        state.history.push({role:'assistant', content: msg});
        save();
        render();
      }
    }

    // events
    sendBtn.addEventListener('click', handleSend);
    inputEl.addEventListener('keydown', (e)=>{
      if (e.key==='Enter' && !e.shiftKey){
        e.preventDefault();
        handleSend();
      }
    });

    clearBtn.addEventListener('click', ()=>{
      if (confirm('–û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç?')){
        state.history = [];
        save();
        render();
      }
    });

    exportBtn.addEventListener('click', ()=>{
      const lines = state.history.map(m=> (m.role==='user'?'–¢—ã: ':'–†–∞–º–∏–ª—èGPT: ') + m.content);
      const blob = new Blob([lines.join('\n\n')], {type:'text/plain;charset=utf-8'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'ramila_chat.txt'; a.click();
      URL.revokeObjectURL(url);
    });

    openSettingsBtn.addEventListener('click', ()=> settingsDlg.showModal());
    closeSettingsBtn.addEventListener('click', ()=> settingsDlg.close());
    saveSettingsBtn.addEventListener('click', ()=>{
      state.cfg.mode = modeSel.value;
      state.cfg.apiBase = apiBaseInp.value.trim() || 'https://api.openai.com/v1';
      state.cfg.apiKey = apiKeyInp.value.trim();
      state.cfg.model = modelInp.value.trim() || 'gpt-4o-mini';
      state.cfg.systemPrompt = systemPromptInp.value.trim() || systemPromptInp.placeholder;
      save(); syncUI(); settingsDlg.close();
    });

    // initial render
    render();
  </script>
</body>
</html>
